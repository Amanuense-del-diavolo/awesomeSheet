var character=function(){return{clone:{attack_count:1,consumable_count:3},input:{race_class:"Elf Wizard",name:"Nif Amakir",level:"6",size:"Medium",alignment:"Lawful Neutral",xp:"23,264",height:"6'0",weight:"136 lbs",age:"120 years",gender:"Male",speed:"30 feet, 6 squares",initiative:"3",gold:"1,090",hero_points:"2",stat_str:"8",stat_dex:"17",stat_con:"14",stat_int:"21",stat_wis:"12",stat_cha:"10",stat_str_temp:"",stat_dex_temp:"",stat_con_temp:"",stat_int_temp:"23",stat_wis_temp:"",stat_cha_temp:"",body_slot_headband:"Headband of Vast Intelligence +2",body_slot_neck:"Amulet of Natural Armor +1",body_slot_ring_left_hand:"Ring of Sustenance",body_slot_shoulders:"Cloak of Resistance +2",hp:"42",current_hp:"42",ac_natural:"1",fortitude_base:"2",fortitude_misc:"5",reflex_base:"2",reflex_misc:"2",will_base:"5",will_misc:"2",base_attack:"3",concentration:"11",skill_appraise_ranks:"4",skill_appraise_misc:"3",skill_knowledge_arcana_ranks:"3",skill_knowledge_arcana_misc:"3",skill_knowledge_dungeoneering_ranks:"2",skill_knowledge_dungeoneering_misc:"3",skill_knowledge_engineering_ranks:"1",skill_knowledge_engineering_misc:"3",skill_knowledge_geography_ranks:"1",skill_knowledge_geography_misc:"3",skill_knowledge_history_ranks:"1",skill_knowledge_history_misc:"3",skill_knowledge_local_ranks:"1",skill_knowledge_local_misc:"3",skill_knowledge_nature_ranks:"1",skill_knowledge_nature_misc:"3",skill_knowledge_nobility_ranks:"1",skill_knowledge_nobility_misc:"3",skill_knowledge_planes_ranks:"3",skill_knowledge_planes_misc:"3",skill_knowledge_religion_ranks:"3",skill_knowledge_religion_misc:"3",skill_linguistics_ranks:"3",skill_linguistics_misc:"3",skill_perception_ranks:"6",skill_perception_misc:"4",skill_sense_motive_ranks:"6",skill_sense_motive_misc:"2",skill_spellcraft_ranks:"6",skill_spellcraft_misc:"3",skill_use_magic_device_ranks:"6",weapon_1:"Dagger MW",attack_1:"3",damage_1:"1d6+1",critical_1:"19–20/×2",ammo_1:"_",range_1:"_",consumable_1:"Wand of Infernal Healing",consumable_total_1:"50",consumable_used_1:"48",consumable_2:"Wand of Lightning Bolt",consumable_total_2:"50",consumable_used_2:"38",consumable_3:"Shift",consumable_total_3:"9",consumable_used_3:"",spells_daily_level_0:"4",spell_dc_level_0:"16",spells_daily_level_1:"5",spell_dc_level_1:"17",spells_daily_level_2:"4",spell_dc_level_2:"18",spells_daily_level_3:"3",spell_dc_level_3:"19",spells_daily_level_4:"",spell_dc_level_4:"",spells_daily_level_5:"",spell_dc_level_5:"",spells_daily_level_6:"",spell_dc_level_6:"",spells_daily_level_7:"",spell_dc_level_7:"",spells_daily_level_8:"",spell_dc_level_8:"",spells_daily_level_9:"",spell_dc_level_9:""},textarea:{feats:"Alertness, Augment Summoning, Craft Wondrous Item, Greater Spell Focus (Conjuration), Scribe Scroll, Spell Focus (Conjuration)",traits:"<strong>Resilient</strong> (+1 trait bonus on Fortitude saves)\n ",languages:"Celestial, Common, Draconic, Dwarven, Elven, Giant, Gnome, Goblin, Orc, Sylvan, Undercommon",special_abilities:'<strong>Arcane bond (Su)</strong> Rat (Bower, +2 Fortitude save),\n <strong>Bonus feats</strong>,\n <strong>Cantrips</strong>,\n <strong>Arcane schools</strong> (Conjuration),\n <strong>Teleportation sub school</strong>,\n <strong>Opposition arcane school</strong> (Enchantment, Necromancy),\n <strong>Elven Immunities (Ex)</strong> (+2 against enchantment spells and effects),\n <strong>Elven Magic (Ex)</strong> (+2 caster level checks made to overcome SR. +2 Spellcraft check to identify properties of magic items),\n <strong>Keen Senses (Ex)</strong> (+2 Perception checks),\n <strong>Low_Light Vision (Ex)</strong> (see x2 as far as humans in low illumination),\n <strong>Headband of Intellect Skill</strong> (Use Magic Device),\n <strong>Linguistics Skill</strong> (Dwarven, Giant, Undercommon),\n <strong>Shift (Su)</strong> (Teleport 15 feet 9 times per day),\n <strong>Summoner\'s Charm (Su)</strong> (+2 rounds duration for Conjuration [summoning] spells),\n <strong>Weapon Familiarity (Ex)</strong> (Proficient with longbows [including composite longbows], longswords, rapiers, and shortbows [including composite shortbows], treat weapon with "elven" in name as a martial weapon)\n ',gear:"Spell component pouch, Spellbook, Backpack, Flask of Oil x3, Pouch (belt), Sack, Candle, Flint and Steel, Tindertwig, Rations (5 days), Waterskin, Bedroll, Blanket, Bloodblock, Healer's Kik, Rope (silk), Mirror, Compass, Ink, Inkpen, Paper sheets, Case for maps/scrolls, Scroll Case, Combat trained horse",magic_gear:"Pearl of Power (1st Level), Potion of CLW x1, Potion of Aid, Vile of Antitoxin, Vile of Holy Water, Scroll of Acid Pit x1, Scroll of Summon Monster III x5, Scroll of Invisibility x2, Scroll of Create Pit x1, Scroll of Web x4, Scroll of Stinking Cloud x2, Scroll of Grease x2, Scroll of Mirror Image x3, Scroll of Spiked Pit x3 Scroll of Fly x2",defense_notes:"+2 against enchantment spells and effects"},spells_known:[{name:"Bleed",level:0,prepared:0,active:!1,cast:0},{name:"Erase",level:0,prepared:0,active:!1,cast:0},{name:"Daze",level:0,prepared:0,active:!1,cast:0},{name:"Disrupt Undead",level:0,prepared:0,active:!1,cast:0},{name:"Touch of Fatigue",level:0,prepared:0,active:!1,cast:0},{name:"Prestidigitation",level:0,prepared:0,active:!1,cast:0},{name:"Light",level:0,prepared:0,active:!1,cast:0},{name:"Ghost Sound",level:0,prepared:0,active:!1,cast:0},{name:"Spark",level:0,prepared:0,active:!1,cast:0},{name:"Acid Splash",level:0,prepared:0,active:!1,cast:0},{name:"Mage Hand",level:0,prepared:0,active:!1,cast:0},{name:"Flare",level:0,prepared:0,active:!1,cast:0},{name:"Detect Magic",level:0,prepared:1,active:!1,cast:0},{name:"Detect Poison",level:0,prepared:0,active:!1,cast:0},{name:"Dancing Lights",level:0,prepared:1,active:!1,cast:0},{name:"Mending",level:0,prepared:0,active:!1,cast:0},{name:"Arcane Mark",level:0,prepared:0,active:!1,cast:0},{name:"Message",level:0,prepared:1,active:!1,cast:0},{name:"Ray of Frost",level:0,prepared:0,active:!1,cast:0},{name:"Read Magic",level:0,prepared:1,active:!1,cast:0},{name:"Open Close",level:0,prepared:0,active:!1,cast:0},{name:"Resistance",level:0,prepared:0,active:!1,cast:0},{name:"Comprehend Languages",level:1,prepared:0,active:!1,cast:0},{name:"Enlarge Person",level:1,prepared:0,active:!1,cast:0},{name:"Feather Fall",level:1,prepared:0,active:!1,cast:0},{name:"Grease",level:1,prepared:2,active:!1,cast:0},{name:"Mage Armor",level:1,prepared:0,active:!1,cast:0},{name:"Mount",level:1,prepared:0,active:!1,cast:0},{name:"Obscuring Mist",level:1,prepared:1,active:!1,cast:0},{name:"Protection from Chaos",level:1,prepared:0,active:!1,cast:0},{name:"Protection from Evil",level:1,prepared:2,active:!1,cast:0},{name:"Shield",level:1,prepared:0,active:!1,cast:0},{name:"Summon Monster I",level:1,prepared:0,active:!1,cast:0},{name:"Unseen Servant",level:1,prepared:0,active:!1,cast:0},{name:"Blur",level:2,prepared:0,active:!1,cast:0},{name:"Create Pit",level:2,prepared:0,active:!1,cast:0},{name:"Flaming Sphere",level:2,prepared:0,active:!1,cast:0},{name:"Glitterdust",level:2,prepared:0,active:!1,cast:0},{name:"Invisibility",level:2,prepared:2,active:!1,cast:0},{name:"Levitate",level:2,prepared:0,active:!1,cast:0},{name:"Mirror Image",level:2,prepared:0,active:!1,cast:0},{name:"Resist Energy",level:2,prepared:0,active:!1,cast:0},{name:"Stone Call",level:2,prepared:0,active:!1,cast:0},{name:"Summon Monster II",level:2,prepared:1,active:!1,cast:0},{name:"Web",level:2,prepared:1,active:!1,cast:0},{name:"Stinking Cloud",level:3,prepared:0,active:!1,cast:0},{name:"Summon Monster III",level:3,prepared:1,active:!1,cast:0},{name:"Spiked Pit",level:3,prepared:1,active:!1,cast:0},{name:"Aqueous Orb",level:3,prepared:0,active:!1,cast:0},{name:"Fly",level:3,prepared:1,active:!1,cast:0},{name:"Sleet Storm",level:3,prepared:0,active:!1,cast:0}]}}(),helper=function(){function a(a){return document.querySelector(a)}function b(a){return document.querySelectorAll(a)}function c(a,b){a.classList.toggle(b)}function d(a,b){a.classList.add(b)}function e(a,b){a.classList.remove(b)}function f(a,b){window.setTimeout(a,b)}function g(a,b){for(var c=b.charAt(0);a&&a!==document;a=a.parentNode){if("."===c&&a.classList.contains(b.substr(1)))return a;if("#"===c&&a.id===b.substr(1))return a;if("["===c&&a.hasAttribute(b.substr(1,b.length-2)))return a;if(a.tagName.toLowerCase()===b)return a}return!1}return{e:a,eA:b,toggleClass:c,addClass:d,removeClass:e,getClosest:g,delayFunction:f}}(),nav=function(){function a(){var a=window.document,b=c.querySelector("span"),d=a.documentElement,e=d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||d.msRequestFullscreen,f=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?(f.call(a),helper.toggleClass(c,"active"),helper.toggleClass(b,"icon-fullscreen-exit"),helper.toggleClass(b,"icon-fullscreen")):(e.call(d),helper.toggleClass(c,"active"),helper.toggleClass(b,"icon-fullscreen-exit"),helper.toggleClass(b,"icon-fullscreen"))}function b(){var b=helper.e("nav"),d=helper.e("nav .toggle-nav"),e=helper.e(".clear-all");c.addEventListener("click",function(){a()},!1),e.addEventListener("click",function(){prompt.render("Are you sure?","All information will be removed. This can not be undone.","clear all"),helper.removeClass(b,"open")},!1),d.addEventListener("click",function(){helper.toggleClass(b,"open")},!1),window.addEventListener("click",function(a){a.target!=b&&helper.getClosest(a.target,"nav")!=b&&helper.removeClass(b,"open")},!1)}var c=helper.e(".toggle-fullscreen");return{bind:b}}(),prompt=function(){function a(a,b,d){var e=helper.e("body"),f=document.createElement("div");f.setAttribute("class","prompt prompt-shade");var g=document.createElement("div");g.setAttribute("class","prompt prompt-modal");var h=document.createElement("div");h.setAttribute("class","container");var i=document.createElement("div");i.setAttribute("class","row");var j=document.createElement("div");j.setAttribute("class","row");var k=document.createElement("div");k.setAttribute("class","col-xs-12");var l=document.createElement("div");l.setAttribute("class","col-xs-6");var m=document.createElement("div");m.setAttribute("class","col-xs-6");var n=document.createElement("div");n.setAttribute("class","prompt-message");var o=document.createElement("h1");o.textContent=a;var p=document.createElement("p");p.textContent=b;var q=document.createElement("button");q.setAttribute("class","button button-primary button-block prompt-action"),q.textContent="OK";var r=document.createElement("button");if(r.setAttribute("class","button button-secondary button-block prompt-cancel"),r.textContent="Cancel",n.appendChild(o),n.appendChild(p),k.appendChild(n),l.appendChild(r),m.appendChild(q),i.appendChild(k),j.appendChild(l),j.appendChild(m),h.appendChild(i),h.appendChild(j),g.appendChild(h),!e.querySelector(".prompt.prompt-shade")&&!e.querySelector(".prompt.prompt-modal")){e.appendChild(f),e.appendChild(g);var s=function(){helper.addClass(g,"reveal"),helper.addClass(f,"reveal")};helper.delayFunction(s,10),c(d)}}function b(){var a=helper.e(".prompt-shade"),b=helper.e(".prompt-modal");helper.e(".prompt-modal .prompt-cancel");if(a&&b){a.style.opacity=0,b.style.opacity=0;var c=function(){a.remove(),b.remove()};helper.delayFunction(c,500)}}function c(a){var c=helper.e(".prompt-shade"),d=(helper.e(".prompt-modal"),helper.e(".prompt-modal .prompt-action")),e=helper.e(".prompt-modal .prompt-cancel");c.addEventListener("click",function(){b()}),e.addEventListener("click",function(){b()}),"clear all"==a&&d.addEventListener("click",function(){sheet.destroy()}),window.addEventListener("keydown",function(a){27==a.keyCode&&b()},!1)}return{render:a,destroy:b}}(),snack=function(){function a(a,d){var e=helper.e(".snacks .snack-bars"),f=document.createElement("div");f.setAttribute("class","snack-bar");var g=document.createElement("div");g.setAttribute("class","row");var h=document.createElement("div");h.setAttribute("class","col-xs-7");var i=document.createElement("div");i.setAttribute("class","col-xs-5");var j=document.createElement("button");j.setAttribute("class","button button-dark button-small snack-clear");var k=document.createElement("span");k.setAttribute("class","icon-close");var l=document.createElement("p");l.setAttribute("class","snack-message"),l.textContent=a,j.appendChild(k),d&&i.appendChild(j),h.appendChild(l),g.appendChild(h),g.appendChild(i),f.appendChild(g);for(var m=e.querySelectorAll(".snack-bar"),n=0;n<m.length;n++){var o=m[n],p=function(){helper.removeClass(o,"reveal")};helper.delayFunction(p,100);var q=function(){o.remove()};helper.delayFunction(q,400)}e.appendChild(f),b(f);var r=function(){helper.addClass(f,"reveal")};helper.delayFunction(r,10);var s=function(){f&&c(f)};helper.delayFunction(s,5e3)}function b(a){var b=helper.getClosest(a,".snack-bar"),d=b.querySelector(".snack-clear");d&&d.addEventListener("click",function(){c(this)},!1),window.addEventListener("keydown",function(a){27==a.keyCode&&c()},!1)}function c(a){if(a)var b=helper.getClosest(a,".snack-bar");else var b=helper.e(".snack-bar");if(b){var c=function(){helper.removeClass(b,"reveal")};helper.delayFunction(c,10);var d=function(){b.remove()};helper.delayFunction(d,500)}}return{render:a,destroy:c}}(),sheet=function(){function a(){b("character",JSON.stringify(f)),console.log(f)}function b(a,b){localStorage.getItem&&localStorage.setItem(a,b)}function c(a){localStorage.getItem&&localStorage.removeItem(a)}function d(a){if(""==localStorage.getItem(a))localStorage.removeItem(a);else if(localStorage.getItem(a))return localStorage.getItem(a)}function e(){localStorage.clear(),document.location.reload(!0),prompt.destroy()}var f;(function(){f=d("character")?JSON.parse(d("character")):character})();return{currentCharacter:f,destroy:e,store:b,remove:c,read:d,storeCharacter:a}}(),clone=function(){function a(a){var b=helper.e("."+a),c=b.querySelector(".clone-controls"),d=c.querySelector(".clone-remove"),e=(b.querySelectorAll(".clone-delete-controls"),b.querySelector(".clone-target")),f=e.querySelectorAll(".clone"),g=f.length;helper.toggleClass(d,"active"),helper.toggleClass(d,"button-primary"),helper.toggleClass(d,"button-secondary"),"true"==b.dataset.deleteCloneState?(helper.removeClass(b,"delete-state"),b.dataset.deleteCloneState="false"):"false"==b.dataset.deleteCloneState&&(helper.addClass(b,"delete-state"),b.dataset.deleteCloneState="true"),0==g&&(helper.removeClass(b,"delete-state"),b.dataset.deleteCloneState="false",helper.removeClass(d,"active"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary"))}function b(a){var b=helper.e("."+a),c=(b.querySelector(".clone-controls"),b.querySelector(".clone-target")),d=c.querySelectorAll(".clone"),e=d.length;e++,"consumables"==a&&(sheet.currentCharacter.clone.consumable_count=e,sheet.storeCharacter()),"attacks"==a&&(sheet.currentCharacter.clone.attack_count=e,sheet.storeCharacter());var f=document.createElement("div");if(f.setAttribute("class","clone"),f.setAttribute("data-clone-count",e),99>=e){c.appendChild(f);var g='<div class="row"><div class="col-xs-8"><div class="input-block"><label class="input-label" for="input-consumable-'+e+'">Item</label><input class="input-field" id="input-consumable-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-4"><div class="row no-gutter"><div class="col-xs-6"><div class="input-block"><label class="input-label" for="input-consumable-total-'+e+'">Total</label><input class="input-field consumable-total" id="input-consumable-total-'+e+'" type="number" tabindex="3"></div></div><div class="col-xs-6"><div class="input-block"><label class="input-label" for="input-consumable-used-'+e+'">Used</label><input class="input-field consumable-used" id="input-consumable-used-'+e+'" type="number" tabindex="3"></div></div></div></div><div class="col-xs-12"><div class="consumable-counts clearfix"></div><div class="clone-delete-controls"><button class="button button-primary button-small button-icon" id="remove-consumable-'+e+'" tabindex="3"><span class="icon-close"></span> Remove</button></div></div></div>',h='<div class="row no-gutter"><div class="col-xs-6"><div class="input-block"><label class="input-label" for="input-weapon-'+e+'">Weapon</label><input class="input-field" id="input-weapon-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-3"><div class="input-block"><label class="input-label" for="input-attack-'+e+'">Attack</label><input class="input-field" id="input-attack-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-3"><div class="input-block"><label class="input-label" for="input-damage-'+e+'">Damage</label><input class="input-field" id="input-damage-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-4"><div class="input-block"><label class="input-label" for="input-range-'+e+'">Range</label><input class="input-field" id="input-range-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-4"><div class="input-block"><label class="input-label" for="input-ammo-'+e+'">Ammo</label><input class="input-field" id="input-ammo-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-4"><div class="input-block"><label class="input-label" for="input-critical-'+e+'">Critical</label><input class="input-field" id="input-critical-'+e+'" type="text" tabindex="3"></div></div><div class="col-xs-12"><div class="clone-delete-controls"><button class="button button-primary button-small button-icon" id="remove-attack-'+e+'" tabindex="3"><span class="icon-close"></span> Remove</button></div></div></div>';"consumables"==a&&(f.innerHTML=g),"attacks"==a&&(f.innerHTML=h)}}function c(){for(var a=sheet.currentCharacter.clone.consumable_count,c=sheet.currentCharacter.clone.attack_count,d=0;a>d;d++)b("consumables");for(var d=0;c>d;d++)b("attacks")}(function(){var c=helper.e(".consumables .clone-add"),d=helper.e(".consumables .clone-remove"),e=helper.e(".attacks .clone-add"),f=helper.e(".attacks .clone-remove");c.addEventListener("click",function(){b("consumables"),snack.render("Consumables block added.",!1,!1)},!1),d.addEventListener("click",function(){a("consumables")},!1),e.addEventListener("click",function(){b("attacks"),snack.render("Attack block added.",!1,!1)},!1),f.addEventListener("click",function(){a("attacks")},!1)})();return{render:c}}(),inputBlock=function(){function a(a){var b=a.id.replace("input-","").replace(/-/g,"_");sheet.currentCharacter.input[b]=a.value,sheet.storeCharacter()}function b(a){var b,c=a.parentNode,d=c.querySelector(".input-field");if(c.querySelector(".input-label"))var b=c.querySelector(".input-label");c.querySelector(".input-label")&&(d==document.activeElement?helper.addClass(b,"input-label-focus"):helper.removeClass(b,"input-label-focus"))}function c(c){for(var d=0;d<c.length;d++){var e=c[d].querySelector(".input-field");e.addEventListener("input",function(){a(this),b(this),totalBlock.render()},!1),e.addEventListener("focus",function(){a(this),b(this),totalBlock.render()},!1),e.addEventListener("blur",function(){a(this),b(this),totalBlock.render()},!1)}}function d(){for(var a in sheet.currentCharacter.input){var b="#input-"+a.replace(/_/g,"-");helper.e(b).value=sheet.currentCharacter.input[a]}}return{focus:b,render:d,bind:c}}(),textareaBlock=function(){function a(a){var b=a.id.replace("textarea-","").replace(/-/g,"_");sheet.currentCharacter.textarea[b]=a.innerHTML,sheet.storeCharacter()}function b(b){for(var c=0;c<b.length;c++){var d=b[c];d.addEventListener("input",function(){a(this)},!1),d.addEventListener("focus",function(){a(this)},!1),d.addEventListener("blur",function(){a(this)},!1)}}function c(){for(var a in sheet.currentCharacter.textarea){var b="#textarea-"+a.replace(/_/g,"-");helper.e(b).innerHTML=sheet.currentCharacter.textarea[a]}}return{render:c,bind:b}}(),spells=function(){function a(a){a.addEventListener("click",function(){b(this),sheet.storeCharacter()},!1)}function b(a){var b=helper.getClosest(a,"#spells"),c=(helper.getClosest(a,".spell-level").dataset.spellLevel,b.dataset.prepareSpellState),d=b.dataset.unprepareSpellState,e=b.dataset.castSpellState,f=b.dataset.activeSpellState,g=b.dataset.deleteSpellState,h=a.querySelector(".spell-marks"),j=a.querySelector(".spell-active");if("true"==c){var k=document.createElement("span");k.setAttribute("class","icon icon-radio-button-checked"),h.insertBefore(k,h.firstChild),h.children.length>0&&(helper.addClass(a,"button-primary"),helper.removeClass(a,"button-tertiary"),helper.removeClass(a,"hidable"))}if("true"==d&&(h.firstChild&&h.firstChild.remove(),h.children.length<=0&&(helper.removeClass(a,"button-primary"),helper.addClass(a,"button-tertiary"),helper.addClass(a,"hidable"))),"true"==e){for(var l=h.children,m=0,n=0;n<l.length;n++)if(l[n].classList.contains("icon-radio-button-checked")){helper.toggleClass(l[n],"icon-radio-button-checked"),helper.toggleClass(l[n],"icon-radio-button-unchecked");break}for(var n=0;n<l.length;n++)l[n].classList.contains("icon-radio-button-checked")&&m++;0>=m&&(helper.removeClass(a,"button-primary"),helper.addClass(a,"button-tertiary"))}if("true"==f){var o=document.createElement("span");o.setAttribute("class","icon icon-play-arrow"),h.children.length>0&&(j.children.length>0?j.firstChild.remove():j.appendChild(o)),h.children.length<=0&&j.children.length>0&&j.firstChild.remove()}if("true"==g){var p=a.dataset.spellName,q=a.textContent,r=p.replace(/\s+/g,"-").toLowerCase();sheet.remove("spell-saved-"+r),a.remove(),snack.render(q+" removed.",!1,!1)}i()}function c(a){var b=helper.getClosest(a,".spell-level").dataset.spellLevel,c=a.value,d=h(c,parseInt(b,10),0,!1,0);""!==c&&(isNaN(c.charAt(0))?(f([d]),a.value="",sheet.currentCharacter.spells_known.push(d),snack.render(c+" added to spell level "+b+".",!1,!1)):snack.render("Name can't start with a number.",!1,!1))}function d(a){var b=event.keyCode||event.which;13==b&&(c(a),sheet.storeCharacter())}function e(a,b){var c=helper.getClosest(a,"#spells"),d=(c.querySelector(".prepare-spell"),c.querySelector(".unprepare-spell"),c.querySelector(".cast-spell"),c.querySelector(".active-spell"),c.querySelector(".remove-spell")),e=c.querySelectorAll(".spell-state-control");if(a.classList.contains("active")){for(var f=0;f<e.length;f++)helper.removeClass(e[f],"active");c.dataset.prepareSpellState="false",c.dataset.unprepareSpellState="false",c.dataset.castSpellState="false",c.dataset.activeSpellState="false",c.dataset.deleteSpellState="false",helper.removeClass(c,"prepare-state"),helper.removeClass(c,"unprepare-state"),helper.removeClass(c,"cast-state"),helper.removeClass(c,"active-state"),helper.removeClass(c,"delete-state"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary")}else{for(var f=0;f<e.length;f++)helper.removeClass(e[f],"active");helper.addClass(a,"active"),"prepare"==b?(c.dataset.prepareSpellState="true",c.dataset.unprepareSpellState="false",c.dataset.castSpellState="false",c.dataset.activeSpellState="false",c.dataset.deleteSpellState="false",helper.addClass(c,"prepare-state"),helper.removeClass(c,"unprepare-state"),helper.removeClass(c,"cast-state"),helper.removeClass(c,"active-state"),helper.removeClass(c,"delete-state"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary")):"unprepare"==b?(c.dataset.prepareSpellState="false",c.dataset.unprepareSpellState="true",c.dataset.castSpellState="false",c.dataset.activeSpellState="false",c.dataset.deleteSpellState="false",helper.removeClass(c,"prepare-state"),helper.addClass(c,"unprepare-state"),helper.removeClass(c,"cast-state"),helper.removeClass(c,"active-state"),helper.removeClass(c,"delete-state"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary")):"cast"==b?(c.dataset.prepareSpellState="false",c.dataset.unprepareSpellState="false",c.dataset.castSpellState="true",c.dataset.activeSpellState="false",c.dataset.deleteSpellState="false",helper.removeClass(c,"prepare-state"),helper.removeClass(c,"unprepare-state"),helper.addClass(c,"cast-state"),helper.removeClass(c,"active-state"),helper.removeClass(c,"delete-state"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary")):"active"==b?(c.dataset.prepareSpellState="false",c.dataset.unprepareSpellState="false",c.dataset.castSpellState="false",c.dataset.activeSpellState="true",c.dataset.deleteSpellState="false",helper.removeClass(c,"prepare-state"),helper.removeClass(c,"unprepare-state"),helper.removeClass(c,"cast-state"),helper.addClass(c,"active-state"),helper.removeClass(c,"delete-state"),helper.removeClass(d,"button-primary"),helper.addClass(d,"button-secondary")):"remove"==b&&(c.dataset.prepareSpellState="false",c.dataset.unprepareSpellState="false",c.dataset.castSpellState="false",c.dataset.activeSpellState="false",c.dataset.deleteSpellState="true",helper.removeClass(c,"prepare-state"),helper.removeClass(c,"unprepare-state"),helper.removeClass(c,"cast-state"),helper.removeClass(c,"active-state"),helper.addClass(c,"delete-state"),helper.addClass(d,"button-primary"),helper.removeClass(d,"button-secondary"))}}function f(b){for(var c=0;c<b.length;c++){var d=b[c],e=helper.e(".spells-known.spell-level-"+d.level),f=g(d.name);e.appendChild(f);var h=f.querySelector(".spell-marks"),i=f.querySelector(".spell-active");if(d.prepared>0){helper.removeClass(f,"hidable"),helper.removeClass(f,"button-tertiary"),helper.addClass(f,"button-primary");for(var j=0;j<d.prepared;j++){var k=document.createElement("span");k.setAttribute("class","icon icon-radio-button-checked"),h.insertBefore(k,h.firstChild)}}if(d.cast>0){for(var l=h.querySelectorAll(".icon-radio-button-checked"),j=0;j<d.cast;j++)l[j]&&(helper.removeClass(l[j],"icon-radio-button-checked"),helper.addClass(l[j],"icon-radio-button-unchecked"));d.cast>=d.prepared&&(helper.removeClass(f,"button-primary"),helper.addClass(f,"button-tertiary"))}if(d.active){var m=document.createElement("span");m.setAttribute("class","icon icon-play-arrow"),d.prepared>0&&(i.children.length>0?i.firstChild.remove():i.appendChild(m))}a(f)}}function g(a){var b=document.createElement("button");b.setAttribute("data-spell-name",a.replace(/\s+/g,"-").toLowerCase()),b.setAttribute("id",a.replace(/\s+/g,"-").toLowerCase()),b.setAttribute("class","spell-known-item button button-tertiary hidable"),b.textContent=a;var c=document.createElement("span");c.setAttribute("class","spell-marks"),b.appendChild(c);var d=document.createElement("span");return d.setAttribute("class","spell-active"),b.appendChild(d),b}function h(a,b,c,d,e){return{name:this.name=a,level:this.level=b,prepared:this.prepared=c||0,active:this.active=d||!1,cast:this.cast=e||0}}function i(){for(var a=helper.eA(".spell-known-item"),b=[],c=0;c<a.length;c++){var d=a[c].textContent,e=parseInt(helper.getClosest(a[c],".spell-level").dataset.spellLevel,10)||0,f=a[c].querySelector(".spell-marks").children.length,g=a[c].querySelector(".spell-marks").querySelectorAll(".icon-radio-button-unchecked").length,i=a[c].querySelector(".spell-active").children.length;i=i>0?!0:!1;var j=new h(d,e,f,i,g);b.push(j)}sheet.currentCharacter.spells_known=b}function j(){var a=[];for(var b in sheet.currentCharacter.spells_known)a.push(sheet.currentCharacter.spells_known[b]);f(a)}(function(){for(var a=helper.eA(".add-spell"),b=0;b<a.length;b++)a[b].addEventListener("click",function(){c(this),i(),sheet.storeCharacter()},!1);for(var b=0;b<a.length;b++){var f=helper.getClosest(a[b],".new-spell"),g=f.querySelector("input");g.addEventListener("keypress",function(){d(this),i(),sheet.storeCharacter()},!1)}helper.e("#spells .prepare-spell").addEventListener("click",function(){e(this,"prepare")},!1),helper.e("#spells .unprepare-spell").addEventListener("click",function(){e(this,"unprepare")},!1),helper.e("#spells .cast-spell").addEventListener("click",function(){e(this,"cast")},!1),helper.e("#spells .active-spell").addEventListener("click",function(){e(this,"active")},!1),helper.e("#spells .remove-spell").addEventListener("click",function(){e(this,"remove")},!1)})();return{render:j}}(),stats=function(){function a(a,c){var d=(parseInt(a.value,10)||0,b(a));c.textContent=d}function b(a){var b=Math.floor((a.value-10)/2);return b}function c(){for(var b=helper.eA(".stats"),c=0;c<b.length;c++){var d=b[c].querySelector(".score"),e=b[c].querySelector(".modifier"),f=b[c].querySelector(".score-temp"),g=b[c].querySelector(".modifier-temp");""!==d.value?a(d,e):e.textContent="",""!==f.value?a(f,g):g.textContent=""}}function d(){for(var a=helper.eA(".stats .score"),b=helper.eA(".stats .score-temp"),d=0;d<a.length;d++)a[d].addEventListener("input",function(){c(),totalBlock.total()},!1);for(var d=0;d<b.length;d++)b[d].addEventListener("input",function(){c(),totalBlock.total()},!1)}return{render:c,bind:d}}(),totalBlock=function(){function a(){function a(){H.length>0&&(I=H.reduce(function(a,b){return a+b}))}for(var b=helper.e(".stats.str .modifier"),c=helper.e(".stats.dex .modifier"),d=helper.e(".stats.con .modifier"),e=helper.e(".stats.int .modifier"),f=helper.e(".stats.wis .modifier"),g=helper.e(".stats.cha .modifier"),h=helper.e(".stats.str .modifier-temp"),i=helper.e(".stats.dex .modifier-temp"),j=helper.e(".stats.con .modifier-temp"),k=helper.e(".stats.int .modifier-temp"),l=helper.e(".stats.wis .modifier-temp"),m=helper.e(".stats.cha .modifier-temp"),n=helper.eA(".input-total-block"),o=0;o<n.length;o++){for(var p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=n[o].querySelector(".total"),G=(parseInt(n[o].querySelector(".total").textContent,10)||0,n[o].querySelectorAll(".input-field")),H=[],I=0,J=0;J<G.length;J++)G.length>0&&"true"==G[J].dataset.modifier&&H.push(parseInt(G[J].value,10)||0);a(),"true"==n[o].dataset.strBonus&&(p=""==h.textContent?parseInt(b.textContent,10):parseInt(h.textContent,10)),"true"==n[o].dataset.dexBonus&&(q=""==i.textContent?parseInt(c.textContent,10):parseInt(i.textContent,10)),"true"==n[o].dataset.conBonus&&(r=""==j.textContent?parseInt(d.textContent,10):parseInt(j.textContent,10)),"true"==n[o].dataset.intBonus&&(s=""==k.textContent?parseInt(e.textContent,10):parseInt(k.textContent,10)),"true"==n[o].dataset.wisBonus&&(t=""==l.textContent?parseInt(f.textContent,10):parseInt(l.textContent,10)),"true"==n[o].dataset.chaBonus&&(u=""==m.textContent?parseInt(g.textContent,10):parseInt(m.textContent,10)),"true"==n[o].dataset.babBonus&&(v=parseInt(helper.e("#input-base-attack").value,10)),"true"==n[o].dataset.sizeBonus&&(w=parseInt(helper.e("#input-size-bonus").value,10)),"true"==n[o].dataset.specialSizeBonus&&(x=parseInt(helper.e("#input-special-size-bonus").value,10)),"true"==n[o].dataset.levelBonus&&(y=parseInt(helper.e("#input-level").value,10)),"true"==n[o].dataset.acArmor&&(A=parseInt(helper.e("#input-ac-armor").value,10)),"true"==n[o].dataset.acShield&&(B=parseInt(helper.e("#input-ac-shield").value,10)),"true"==n[o].dataset.acDeflect&&(C=parseInt(helper.e("#input-ac-deflect").value,10)),"true"==n[o].dataset.acDodge&&(D=parseInt(helper.e("#input-ac-dodge").value,10)),"true"==n[o].dataset.acNatural&&(E=parseInt(helper.e("#input-ac-natural").value,10)),"true"==n[o].dataset.plusTenBonus&&(z=10),isNaN(y)&&(y=0),isNaN(p)&&(p=0),isNaN(q)&&(q=0),isNaN(r)&&(r=0),isNaN(s)&&(s=0),isNaN(t)&&(t=0),isNaN(u)&&(u=0),isNaN(v)&&(v=0),isNaN(w)&&(w=0),isNaN(x)&&(x=0),isNaN(y)&&(y=0),isNaN(z)&&(z=0),isNaN(A)&&(A=0),isNaN(B)&&(B=0),isNaN(C)&&(C=0),isNaN(D)&&(D=0),isNaN(E)&&(E=0);var K=I+y+v+w+x+z+p+q+r+s+t+u+A+B+C+D+E;F.textContent=K}}return{render:a}}();!function(){function a(a){function c(){var a=document.createElement("div");a.setAttribute("class","check-group"),e.appendChild(a)}var d=helper.getClosest(a,".clone"),e=d.querySelector(".consumable-counts"),f=parseInt(a.value,10)||0,g=e.querySelector(".check-group"),h=e.querySelectorAll(".check").length;for(g||f>0&&c();f>h;){var g=e.lastChild;g.children.length>=10&&(c(),g=e.lastChild);var i=document.createElement("span");i.setAttribute("class","check"),g.appendChild(i),
h++}for(;h>f;){var g=e.lastChild;g.children.length>0&&g.removeChild(g.lastChild),g.children.length<=0&&(g.remove(),h>0&&(g=e.querySelector(".check-group"))),h--}b(a)}function b(a){for(var b=helper.getClosest(a,".clone"),c=b.querySelector(".consumable-counts"),d=b.querySelector(".consumable-used"),e=parseInt(d.value,10)||0,f=c.querySelectorAll(".check"),g=f.length-e,h=0;h<f.length;h++)helper.addClass(f[h],"used");for(var h=0;g>h;h++)helper.removeClass(f[h],"used")}function c(){for(var b=helper.eA(".consumable-total"),c=0;c<b.length;c++)a(b[c])}function d(){for(var a=helper.eA(".consumable-used"),c=0;c<a.length;c++)b(a[c])}function e(){for(var a=helper.eA(".hidable-block"),b=0;b<a.length;b++){var c=a[b].querySelector(".hidable-toggle");c.addEventListener("click",function(){f(this)},!1)}}function f(a){var b=(a.textContent,a.querySelector(".icon")),c=a.querySelector(".text"),d=helper.getClosest(a,".hidable-block"),e=d.querySelectorAll(".hidable"),f=d.querySelectorAll(".hidable-on-empty-input"),g=d.querySelectorAll(".hidable-on-empty-textarea");if("true"==d.dataset.allHidden){for(var h=0;h<e.length;h++)helper.removeClass(e[h],"hidden");for(var h=0;h<f.length;h++)helper.removeClass(f[h],"hidden");for(var h=0;h<g.length;h++)helper.removeClass(g[h],"hidden");d.dataset.allHidden="false",helper.toggleClass(b,"icon-unfold-less"),helper.toggleClass(b,"icon-unfold-more"),c.textContent="Hide"}else if("false"==d.dataset.allHidden){for(var h=0;h<f.length;h++){var i=f[h].querySelector(".input-field");(null==i.value||""==i.value)&&helper.addClass(f[h],"hidden")}for(var h=0;h<e.length;h++)helper.addClass(e[h],"hidden");for(var h=0;h<g.length;h++){var j=g[h].querySelector(".textarea");(null==j.textContent||""==j.textContent)&&helper.addClass(g[h],"hidden")}d.dataset.allHidden="true",helper.toggleClass(b,"icon-unfold-less"),helper.toggleClass(b,"icon-unfold-more"),c.textContent="Show"}}c(),d(),e()}(),function(){nav.bind(),sheet.storeCharacter(),clone.render(),inputBlock.bind(helper.eA(".input-block")),inputBlock.render(),textareaBlock.bind(helper.eA(".textarea-block")),textareaBlock.render(),spells.render(),stats.render(),stats.bind(),totalBlock.render()}();